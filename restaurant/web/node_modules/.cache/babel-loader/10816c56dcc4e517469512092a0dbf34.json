{"ast":null,"code":"const {\n  BaseTransaction,\n  TransactionError,\n  utils\n} = require('@liskhq/lisk-transactions');\n\nclass FoodTransaction extends BaseTransaction {\n  get sidechainAccountId() {\n    return \"6181773985994883123L\";\n  }\n\n  get sidechainFee() {\n    return '50000000';\n  }\n\n  static get TYPE() {\n    return 820;\n  }\n\n  static get FEE() {\n    return `10000000`;\n  }\n\n  /* Prepare function stores both sender and recipient account in the cache so it is possible to\r\n     modify the accounts during the `applyAsset` and `undoAsset` steps. */\n  async prepare(store) {\n    await store.account.cache([{\n      address: this.asset.recipientId\n    }, {\n      address: this.senderId\n    }, {\n      address: this.sidechainAccountId\n    }]);\n  }\n\n  validateAsset() {\n    const errors = [];\n    /*\r\n            if(!utils.validateAddress(this.senderId)){\r\n                errors.push(new TransactionError(\r\n                    'Invalid client \"Lisk address\" defined on transaction',\r\n                    this.id,\r\n                    \"client lisk address\",\r\n                    this.senderId\r\n                ));\r\n            }\r\n    \r\n            if (!utils.validatePublicKey(this.senderPublicKey)){\r\n                errors.push(new TransactionError(\r\n                    'Invalid client \"Lisk public key\" defined on transaction',\r\n                    this.id,\r\n                    \"client public key\",\r\n                    this.senderPublicKey\r\n                ));\r\n            }                               \r\n    \r\n            if (!this.asset.description || typeof this.asset.description !== 'string' || this.asset.name.length > 1500){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"description\" defined on transaction',\r\n                        this.id,\r\n                        '.asset.description',\r\n                        this.asset.name,\r\n                        'A string value no longer than 1500 characters'\r\n                    )\r\n                );\r\n            }\r\n    \r\n            if (!this.asset.foodType || this.asset.foodType <= 0){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"food type\" defined on transaction',\r\n                        this.id,\r\n                        '.foodType',\r\n                        this.asset.foodType,\r\n                        'A value bigger than 0'\r\n                    )\r\n                );\r\n            }\r\n    \r\n            if (!this.asset.deliveryaddress){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"delivery address\" defined on transaction',\r\n                        this.id,\r\n                        '.deliveryaddress',\r\n                        this.asset.deliveryaddress,\r\n                        'A string value bigger than 0'\r\n                    )\r\n                );\r\n            }\r\n    \r\n            if (!this.asset.phone){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"phone\" defined on transaction',\r\n                        this.id,\r\n                        '.phone',\r\n                        this.asset.phone,\r\n                        'A value bigger than 0'\r\n                    )\r\n                );\r\n            }\r\n    \r\n            if (!this.asset.username){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"username\" defined on transaction',\r\n                        this.id,\r\n                        '.username',\r\n                        this.asset.username,\r\n                        'A string value bigger than 0'\r\n                    )\r\n                );\r\n            }\r\n            \r\n            if (!this.asset.amount || this.asset.amount <= 0){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"value\" defined on transaction',\r\n                        this.id,\r\n                        '.asset.amount',\r\n                        this.asset.amount,\r\n                        'A value bigger than 0'\r\n                    )\r\n                );\r\n            }\r\n    \r\n            if (!this.asset.clientData || this.asset.clientData.length === 0){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"clientData\" defined on transaction',\r\n                        this.id,\r\n                        '.clientData',\r\n                        this.asset.clientData,\r\n                        'Not empty'\r\n                    )\r\n                );\r\n            }\r\n    \r\n            if (!this.asset.clientNonce || this.asset.clientNonce.length === 0){\r\n                errors.push(\r\n                    new TransactionError(\r\n                        'Invalid \"clientNonce\" defined on transaction',\r\n                        this.id,\r\n                        '.clientNonce',\r\n                        this.asset.clientNonce,\r\n                        'Not empty'\r\n                    )\r\n                );\r\n            }\r\n    */\n\n    return errors;\n  }\n\n  applyAsset(store) {\n    const errors = [];\n    const sender = store.account.get(this.senderId);\n\n    if (!sender) {\n      errors.push(new TransactionError('Invalid \"sender\", please verify your passphrase', this.id, '.sender', this.senderId, 'Verify your passpahrase and address'));\n    }\n\n    const senderBalanceDeducted = new utils.BigNum(sender.balance).sub(new utils.BigNum(this.asset.amount));\n\n    if (senderBalanceDeducted < 0) {\n      errors.push(new TransactionError('Not enough \"balance\" for the transaction', this.id, '.asset.amount', this.asset.amount, 'Need a balance at least equal than amount'));\n    }\n\n    const updatedSender = { ...sender,\n      balance: senderBalanceDeducted.toString()\n    };\n    store.account.set(sender.address, updatedSender);\n    const restaurantAccount = store.account.get(this.asset.recipientId);\n    const restaurantBalanceWithFoodRequest = new utils.BigNum(restaurantAccount.balance).add(new utils.BigNum(this.asset.amount)).sub(new utils.BigNum(this.sidechainFee));\n    const updatedRestaurantAccount = { ...restaurantAccount,\n      ...{\n        balance: restaurantBalanceWithFoodRequest.toString(),\n        asset: {\n          name: this.asset.name,\n          description: this.asset.description,\n          foodType: this.asset.foodType,\n          username: this.asset.username,\n          phone: this.asset.phone,\n          deliveryaddress: this.asset.deliveryaddress,\n          observation: this.asset.observation,\n          clientData: this.asset.clientData,\n          clientNonce: this.asset.clientNonce,\n          recipientId: this.asset.recipientId,\n          amount: this.asset.amount\n        }\n      }\n    };\n    store.account.set(restaurantAccount.address, updatedRestaurantAccount);\n    /*\r\n    const sidechainAcc = store.account.get(this.sidechainAccountId);\r\n    const sidechainBalanceWithFee = new utils.BigNum(sidechainAcc.balance).add(new utils.BigNum(this.sidechainFee));\r\n    const updatedSidechainAccount = {\r\n        ...sidechainAcc,\r\n        balance: sidechainBalanceWithFee.toString(),\r\n        asset: {\r\n            message: \"fee\"\r\n        }\r\n    };\r\n      store.account.set(sidechainAcc.address, updatedSidechainAccount);\r\n            */\n\n    return errors;\n  }\n  /* UndoAsset function tells the blockchain how to rollback changes made in the applyAsset function.\r\n      The original balance for both the sender and restaurant account is restored.\r\n      In addition, the `asset` field for the restaurant account `null` is reseted, as it did not hold any previous data.*/\n\n  /* --- Revert sender account --- */\n\n\n  undoAsset(store) {\n    const sender = store.account.get(this.senderId);\n    const senderBalanceWithFoodAmount = new utils.BigNum(sender.balance).add(new utils.BigNum(this.asset.amount));\n    const updatedSender = { ...sender,\n      balance: senderBalanceWithFoodAmount.toString()\n    };\n    store.account.set(sender.address, updatedSender);\n    const restaurantAccount = store.account.get(this.asset.recipientId);\n    const restaurantBalanceWithFoodRequest = new utils.BigNum(restaurantAccount.balance).sub(new utils.BigNum(this.asset.amount).add(new utils.BigNum(this.sidechainFee)));\n    const updatedRestaurantAccount = { ...sender,\n      ...{\n        balance: restaurantBalanceWithFoodRequest.toString(),\n        asset: null\n      }\n    };\n    store.account.set(restaurantAccount.address, updatedRestaurantAccount);\n    /*\r\n            const sidechainAcc = store.account.get(this.sidechainAccount);\r\n            const sidechainBalanceWithoutFee = new utils.BigNum(sidechainAcc.balance).sub(new utils.BigNum(this.sidechainFee));\r\n    \r\n            const updatedSidechainAccount = {\r\n                ...sidechainAcc,\r\n                balance: sidechainBalanceWithoutFee.toString()\r\n            };\r\n    \r\n            store.account.set(sidechainAcc.address, updatedSidechainAccount);\r\n    */\n\n    return [];\n  }\n\n}\n\nmodule.exports = FoodTransaction;","map":{"version":3,"sources":["C:/PoC/restaurant_sidechain/web/src/FoodTransaction.js"],"names":["BaseTransaction","TransactionError","utils","require","FoodTransaction","sidechainAccountId","sidechainFee","TYPE","FEE","prepare","store","account","cache","address","asset","recipientId","senderId","validateAsset","errors","applyAsset","sender","get","push","id","senderBalanceDeducted","BigNum","balance","sub","amount","updatedSender","toString","set","restaurantAccount","restaurantBalanceWithFoodRequest","add","updatedRestaurantAccount","name","description","foodType","username","phone","deliveryaddress","observation","clientData","clientNonce","undoAsset","senderBalanceWithFoodAmount","module","exports"],"mappings":"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","sourcesContent":["const {\r\n    BaseTransaction,\r\n    TransactionError, \r\n    utils\r\n} = require('@liskhq/lisk-transactions');\r\n\r\nclass FoodTransaction extends BaseTransaction {    \r\n\r\n    get sidechainAccountId () {\r\n        return \"6181773985994883123L\";\r\n    }\r\n\r\n    get sidechainFee () {\r\n        return '50000000';\r\n    }\r\n\r\n    static get TYPE() {\r\n        return 820;\r\n    }\r\n\r\n    static get FEE () {\r\n\t\treturn `10000000`;\r\n    };        \r\n\r\n    /* Prepare function stores both sender and recipient account in the cache so it is possible to\r\n       modify the accounts during the `applyAsset` and `undoAsset` steps. */\r\n    async prepare(store) {\r\n        await store.account.cache([\r\n            {\r\n                address: this.asset.recipientId,\r\n            },\r\n            {\r\n                address: this.senderId,\r\n            },\r\n            {\r\n                address: this.sidechainAccountId\r\n            }\r\n        ]);\r\n    }\r\n\r\n    validateAsset(){\r\n        const errors = [];        \r\n/*\r\n        if(!utils.validateAddress(this.senderId)){\r\n            errors.push(new TransactionError(\r\n                'Invalid client \"Lisk address\" defined on transaction',\r\n                this.id,\r\n                \"client lisk address\",\r\n                this.senderId\r\n            ));\r\n        }\r\n\r\n        if (!utils.validatePublicKey(this.senderPublicKey)){\r\n            errors.push(new TransactionError(\r\n                'Invalid client \"Lisk public key\" defined on transaction',\r\n                this.id,\r\n                \"client public key\",\r\n                this.senderPublicKey\r\n            ));\r\n        }                               \r\n\r\n        if (!this.asset.description || typeof this.asset.description !== 'string' || this.asset.name.length > 1500){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"description\" defined on transaction',\r\n                    this.id,\r\n                    '.asset.description',\r\n                    this.asset.name,\r\n                    'A string value no longer than 1500 characters'\r\n                )\r\n            );\r\n        }\r\n\r\n        if (!this.asset.foodType || this.asset.foodType <= 0){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"food type\" defined on transaction',\r\n                    this.id,\r\n                    '.foodType',\r\n                    this.asset.foodType,\r\n                    'A value bigger than 0'\r\n                )\r\n            );\r\n        }\r\n\r\n        if (!this.asset.deliveryaddress){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"delivery address\" defined on transaction',\r\n                    this.id,\r\n                    '.deliveryaddress',\r\n                    this.asset.deliveryaddress,\r\n                    'A string value bigger than 0'\r\n                )\r\n            );\r\n        }\r\n\r\n        if (!this.asset.phone){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"phone\" defined on transaction',\r\n                    this.id,\r\n                    '.phone',\r\n                    this.asset.phone,\r\n                    'A value bigger than 0'\r\n                )\r\n            );\r\n        }\r\n\r\n        if (!this.asset.username){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"username\" defined on transaction',\r\n                    this.id,\r\n                    '.username',\r\n                    this.asset.username,\r\n                    'A string value bigger than 0'\r\n                )\r\n            );\r\n        }\r\n        \r\n        if (!this.asset.amount || this.asset.amount <= 0){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"value\" defined on transaction',\r\n                    this.id,\r\n                    '.asset.amount',\r\n                    this.asset.amount,\r\n                    'A value bigger than 0'\r\n                )\r\n            );\r\n        }\r\n\r\n        if (!this.asset.clientData || this.asset.clientData.length === 0){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"clientData\" defined on transaction',\r\n                    this.id,\r\n                    '.clientData',\r\n                    this.asset.clientData,\r\n                    'Not empty'\r\n                )\r\n            );\r\n        }\r\n\r\n        if (!this.asset.clientNonce || this.asset.clientNonce.length === 0){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"clientNonce\" defined on transaction',\r\n                    this.id,\r\n                    '.clientNonce',\r\n                    this.asset.clientNonce,\r\n                    'Not empty'\r\n                )\r\n            );\r\n        }\r\n*/\r\n        return errors;\r\n    }\r\n\r\n    applyAsset(store){               \r\n        const errors = [];\r\n        \r\n        const sender = store.account.get(this.senderId);\r\n\r\n        if (!sender){           \r\n            errors.push(\r\n                new TransactionError(\r\n                    'Invalid \"sender\", please verify your passphrase',\r\n                    this.id,\r\n                    '.sender',\r\n                    this.senderId,\r\n                    'Verify your passpahrase and address'\r\n                )\r\n            );            \r\n        }\r\n\r\n        const senderBalanceDeducted = new utils.BigNum(sender.balance).sub(new utils.BigNum(this.asset.amount));            \r\n\r\n        if (senderBalanceDeducted < 0){\r\n            errors.push(\r\n                new TransactionError(\r\n                    'Not enough \"balance\" for the transaction',\r\n                    this.id,\r\n                    '.asset.amount',\r\n                    this.asset.amount,\r\n                    'Need a balance at least equal than amount'\r\n                )\r\n            );\r\n        }\r\n\r\n        const updatedSender = {\r\n            ...sender,\r\n            balance: senderBalanceDeducted.toString()\r\n        }\r\n        store.account.set(sender.address, updatedSender);\r\n\r\n        const restaurantAccount = store.account.get(this.asset.recipientId);\r\n        const restaurantBalanceWithFoodRequest = new utils.BigNum(restaurantAccount.balance).add(new utils.BigNum(this.asset.amount)).sub(new utils.BigNum(this.sidechainFee)); \r\n        \r\n        const updatedRestaurantAccount = {...restaurantAccount, \r\n            ...{ \r\n                balance: restaurantBalanceWithFoodRequest.toString(),\r\n                asset: { \r\n                    name: this.asset.name, \r\n                    description: this.asset.description, \r\n                    foodType: this.asset.foodType, \r\n                    username: this.asset.username, \r\n                    phone: this.asset.phone, \r\n                    deliveryaddress: this.asset.deliveryaddress,\r\n                    observation: this.asset.observation,\r\n                    clientData: this.asset.clientData,\r\n                    clientNonce: this.asset.clientNonce,\r\n                    recipientId: this.asset.recipientId,\r\n                    amount: this.asset.amount\r\n                }\r\n            }\r\n        };        \r\n\r\n        store.account.set(restaurantAccount.address, updatedRestaurantAccount);\r\n        /*\r\n        const sidechainAcc = store.account.get(this.sidechainAccountId);\r\n        const sidechainBalanceWithFee = new utils.BigNum(sidechainAcc.balance).add(new utils.BigNum(this.sidechainFee));\r\n        const updatedSidechainAccount = {\r\n            ...sidechainAcc,\r\n            balance: sidechainBalanceWithFee.toString(),\r\n            asset: {\r\n                message: \"fee\"\r\n            }\r\n        };\r\n\r\n        store.account.set(sidechainAcc.address, updatedSidechainAccount);\r\n                */\r\n        return errors;\r\n    }\r\n\r\n    /* UndoAsset function tells the blockchain how to rollback changes made in the applyAsset function.\r\n        The original balance for both the sender and restaurant account is restored.\r\n        In addition, the `asset` field for the restaurant account `null` is reseted, as it did not hold any previous data.*/\r\n    /* --- Revert sender account --- */\r\n    undoAsset(store){\r\n        const sender = store.account.get(this.senderId);\r\n\r\n        const senderBalanceWithFoodAmount = new utils.BigNum(sender.balance).add(new utils.BigNum(this.asset.amount));\r\n        const updatedSender = {\r\n            ...sender,\r\n            balance: senderBalanceWithFoodAmount.toString()\r\n        };\r\n        store.account.set(sender.address, updatedSender);\r\n\r\n        const restaurantAccount = store.account.get(this.asset.recipientId);\r\n        const restaurantBalanceWithFoodRequest = new utils.BigNum(restaurantAccount.balance).sub(new utils.BigNum(this.asset.amount).add(new utils.BigNum(this.sidechainFee)));\r\n\r\n        const updatedRestaurantAccount = {...sender, \r\n            ... { balance: restaurantBalanceWithFoodRequest.toString(),\r\n            asset: null }\r\n        };\r\n        store.account.set(restaurantAccount.address, updatedRestaurantAccount);\r\n/*\r\n        const sidechainAcc = store.account.get(this.sidechainAccount);\r\n        const sidechainBalanceWithoutFee = new utils.BigNum(sidechainAcc.balance).sub(new utils.BigNum(this.sidechainFee));\r\n\r\n        const updatedSidechainAccount = {\r\n            ...sidechainAcc,\r\n            balance: sidechainBalanceWithoutFee.toString()\r\n        };\r\n\r\n        store.account.set(sidechainAcc.address, updatedSidechainAccount);\r\n*/\r\n        return [];\r\n    }\r\n}\r\n\r\nmodule.exports = FoodTransaction;"]},"metadata":{},"sourceType":"module"}